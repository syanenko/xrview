<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Load object from ZBrush, selection test</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="expires" content="timestamp">
		<link type="text/css" rel="stylesheet" href="zvr.css">
	</head>

	<body>
		<div class="info">Z-VR</div>
    <div id="name">Model_01</div>

    <!-- Video -->
    <video id="video" style="display:none" playsinline></video>
    <input id="video_button"  type="image" src="./data/images/camera_70x56.png" style="position:absolute; right:10px; bottom:10px; opacity:0.5"/>

    <!-- Imports -->
		<script type="importmap">
			{
				"imports": {
					"three": "./three/three.module.js",
					"three/addons/": "./three/jsm/"
				}
			}
		</script>
		<script type="module" src="zvr.js"></script>

    <!-- Upload model -->
    <div id="form_upload">
      <form encType="multipart/form-data">
          Upload model<br/><br/>
        <input name="model"   type="file" /><br/>
        <input name="texture" type="file" /><br/>
        <input name="normals" type="file" /><br/><br/>
        <input type="submit"  value="Upload"/>
      </form>
    </duv>

    <script>
      var form = document.getElementById('form_upload');

      // Add a submit event listener to the form
      form.addEventListener('submit', function(e) {
        // Prevent the default form submission behavior
        e.preventDefault();

        // Create a new FormData object
        var formData = new FormData();

        // Get the selected file
        var model   = form.querySelector('[name="model"]'  ).files[0];
        var texture = form.querySelector('[name="texture"]').files[0];
        var normals = form.querySelector('[name="normals"]').files[0];

        // Add the file to the FormData object
        formData.append('model',   model);
        formData.append('texture', texture);
        formData.append('normals', normals);

        // Create an XMLHttpRequest object
        var xhr = new XMLHttpRequest();

        // Set the request URL
        xhr.open('POST', 'http://localhost:8081/upload.php');

        // Set the request as asynchronous
        // xhr.responseType = 'json';
        
        // Set the request onload event listener
        xhr.onload = function() {
          if (xhr.status === 200) {
            // The image was successfully uploaded
            console.log(xhr.response);
            window.loadModel({model:xhr.response});
          } else {
            // There was an error uploading the image
            console.error(xhr.response);
          }
        }
        // Send the request
        xhr.send(formData);
        form.style.visibility = 'hidden';
      });
    </script>

	</body>
</html>
